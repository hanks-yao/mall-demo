(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4ca1e5b3"],{"20b4":function(e,t,s){"use strict";s("2c79")},2433:function(e,t,s){"use strict";s("a8cc")},"2c79":function(e,t,s){},"2f94":function(c,e,t){"use strict";t.d(e,"e",function(){return i}),t.d(e,"f",function(){return a}),t.d(e,"b",function(){return o}),t.d(e,"a",function(){return n}),t.d(e,"c",function(){return r}),t.d(e,"d",function(){return d});var s=t("ff66");function i(){return Object(s.d)({url:"/buyer/memberAddress",needToken:!0,method:s.a.GET})}function a(e){return Object(s.d)({url:"/buyer/memberAddress",needToken:!0,method:s.a.POST,data:e})}function o(e){return Object(s.d)({url:"/buyer/memberAddress",needToken:!0,method:s.a.PUT,params:e})}function n(e){return Object(s.d)({url:"/buyer/memberAddress/delById/"+e,needToken:!0,method:s.a.DELETE})}function r(e){return Object(s.d)({url:"/buyer/memberAddress/get/"+e,needToken:!0,method:s.a.GET})}function d(e){return Object(s.d)({url:s.c+"/common/region/region",needToken:!0,method:s.a.GET,params:e})}},3577:function(e,t,s){"use strict";s("b88b")},5945:function(e,t,s){"use strict";var i=s("862d"),a=s.n(i),o=s("2f94"),i={name:"map",props:{useApi:{default:!0,type:Boolean}},data(){return{config:s("f121"),showMap:!1,mapSearch:"",map:null,autoComplete:null,geocoder:null,positionPicker:null,tips:[],addrContent:{},loading:!1}},watch:{mapSearch:function(e){this.searchOfMap(e)}},methods:{ok(){this.loading=!0;const e=this.addrContent.address,t=this.addrContent.regeocode.addressComponent.township,s=e.indexOf(t)+t.length;this.addrContent.detail=e.substring(s);var i={cityCode:this.addrContent.regeocode.addressComponent.citycode,townName:this.addrContent.regeocode.addressComponent.township};this.useApi?Object(o.d)(i).then(e=>{this.loading=!1,e.success&&(this.showMap=!1,this.addrContent.addr=e.result.name.replace(/,/g," "),this.addrContent.addrId=e.result.id,this.$emit("getAddress",this.addrContent))}):(this.loading=!1,this.showMap=!1,this.$emit("getAddress",this.addrContent))},init(){a.a.load({key:this.config.aMapKey,version:"",plugins:["AMap.ToolBar","AMap.Autocomplete","AMap.PlaceSearch","AMap.Geolocation","AMap.Geocoder"],AMapUI:{version:"1.1",plugins:["misc/PositionPicker"]}}).then(e=>{let t=this;this.map=new e.Map("map-container",{zoom:12}),t.map.addControl(new e.ToolBar),t.map.addControl(new e.Autocomplete),t.map.addControl(new e.PlaceSearch),t.map.addControl(new e.Geocoder);var s={city:"全国"};t.autoComplete=new e.Autocomplete(s),t.geocoder=new e.Geocoder(s),t.positionPicker=new AMapUI.PositionPicker({mode:"dragMap",map:t.map}),t.positionPicker.start(),t.positionPicker.on("success",function(e){t.addrContent=e})}).catch(e=>{})},searchOfMap(e){let s=this;this.autoComplete.search(e,function(e,t){"complete"===e&&"OK"===t.info?s.tips=t.tips:s.tips=[]})},selectAddr(e){if(!e)return this.$Message.warning("请选择正确点位"),!1;e=[e.lng,e.lat];this.positionPicker.start(e)}},mounted(){this.init()}},n=(s("3577"),s("2877")),n=Object(n.a)(i,function(){var s=this,e=s.$createElement,i=s._self._c||e;return i("div",{staticClass:"lili-map"},[i("Modal",{attrs:{title:"选择地址",width:"800"},model:{value:s.showMap,callback:function(e){s.showMap=e},expression:"showMap"}},[i("div",{staticClass:"address"},[s._v(s._s(s.addrContent.address))]),i("div",{attrs:{id:"map-container"}}),i("div",{staticClass:"search-con"},[i("Input",{attrs:{placeholder:"输入关键字搜索",id:"input-map"},model:{value:s.mapSearch,callback:function(e){s.mapSearch=e},expression:"mapSearch"}}),i("ul",s._l(s.tips,function(t,e){return i("li",{key:e,on:{click:function(e){return s.selectAddr(t.location)}}},[i("p",[s._v(s._s(t.name))]),i("p",[s._v(s._s(t.district+t.address))])])}),0)],1),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"default"},on:{click:function(e){s.showMap=!1}}},[s._v("取消")]),i("Button",{attrs:{type:"primary",loading:s.loading},on:{click:s.ok}},[s._v("确定")])],1)])],1)},[],!1,null,"a80f964e",null);t.a=n.exports},"7dfd":function(l,e,t){"use strict";t.r(e),t.d(e,"mobile",function(){return s}),t.d(e,"email",function(){return i}),t.d(e,"password",function(){return a}),t.d(e,"integer",function(){return o}),t.d(e,"Integer",function(){return n}),t.d(e,"money",function(){return r}),t.d(e,"TINumber",function(){return d}),t.d(e,"IDCard",function(){return c}),t.d(e,"userName",function(){return p}),t.d(e,"URL",function(){return u}),t.d(e,"TEL",function(){return h}),t.d(e,"licenseNum",function(){return m});const s=/^0?(13[0-9]|14[0-9]|15[0-9]|16[0-9]|17[0-9]|18[0-9]|19[0-9])[0-9]{8}$/,i=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,a=/^[@A-Za-z0-9!#$%^&*.~,]{6,20}$/,o=/^[1-9]\d*$/,n=/^[0-9]\d*$/,r=/(^[1-9]([0-9]+)?(\.[0-9]{1,2})?$)|(^(0){1}$)|(^[0-9]\.[0-9]([0-9])?$)/,d=/^((\d{6}[0-9A-Z]{9})|([0-9A-Za-z]{2}\d{6}[0-9A-Za-z]{10,12}))$/,c=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/,p=/[A-Za-z0-9_\-\u4e00-\u9fa5]$/,u=/^(https?|ftp):\/\/([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/,h=/0\d{2,3}-\d{7,8}/,m=/(^(?:(?![IOZSV])[\dA-Z]){2}\d{6}(?:(?![IOZSV])[\dA-Z]){10}$)|(^\d{15}$)/},"862d":function(e,t,s){"use strict";e.exports=function(){function r(e){var t=[];return e.AMapUI&&t.push(s(e.AMapUI)),e.Loca&&t.push(i(e.Loca)),Promise.all(t)}function s(n){return new Promise(function(i,t){var a=[];if(n.plugins)for(var e=0;e<n.plugins.length;e+=1)-1==c.AMapUI.plugins.indexOf(n.plugins[e])&&a.push(n.plugins[e]);if(l.AMapUI===d.failed)t("前次请求 AMapUI 失败");else if(l.AMapUI===d.notload){l.AMapUI=d.loading,c.AMapUI.version=n.version||c.AMapUI.version,e=c.AMapUI.version;var s=document.body||document.head,o=document.createElement("script");o.type="text/javascript",o.src="https://webapi.amap.com/ui/"+e+"/main.js",o.onerror=function(e){l.AMapUI=d.failed,t("请求 AMapUI 失败")},o.onload=function(){if(l.AMapUI=d.loaded,a.length)window.AMapUI.loadUI(a,function(){for(var e=0,t=a.length;e<t;e++){var s=a[e].split("/").slice(-1)[0];window.AMapUI[s]=arguments[e]}for(i();p.AMapUI.length;)p.AMapUI.splice(0,1)[0]()});else for(i();p.AMapUI.length;)p.AMapUI.splice(0,1)[0]()},s.appendChild(o)}else l.AMapUI===d.loaded?n.version&&n.version!==c.AMapUI.version?t("不允许多个版本 AMapUI 混用"):a.length?window.AMapUI.loadUI(a,function(){for(var e=0,t=a.length;e<t;e++){var s=a[e].split("/").slice(-1)[0];window.AMapUI[s]=arguments[e]}i()}):i():n.version&&n.version!==c.AMapUI.version?t("不允许多个版本 AMapUI 混用"):p.AMapUI.push(function(e){e?t(e):a.length?window.AMapUI.loadUI(a,function(){for(var e=0,t=a.length;e<t;e++){var s=a[e].split("/").slice(-1)[0];window.AMapUI[s]=arguments[e]}i()}):i()})})}function i(n){return new Promise(function(e,t){if(c.AMap.version.startsWith("2.0"))t("Loca 暂不适配 JSAPI 2.0,请使用 1.4.15");else if(l.Loca===d.failed)t("前次请求 Loca 失败");else if(l.Loca===d.notload){l.Loca=d.loading,c.Loca.version=n.version||c.Loca.version;var s=c.Loca.version,i=c.key,a=document.body||document.head,o=document.createElement("script");o.type="text/javascript",o.src="https://webapi.amap.com/loca?v="+s+"&key="+i,o.onerror=function(e){l.Loca=d.failed,t("请求 AMapUI 失败")},o.onload=function(){for(l.Loca=d.loaded,e();p.Loca.length;)p.Loca.splice(0,1)[0]()},a.appendChild(o)}else l.Loca===d.loaded?n.version&&n.version!==c.Loca.version?t("不允许多个版本 Loca 混用"):e():n.version&&n.version!==c.Loca.version?t("不允许多个版本 Loca 混用"):p.Loca.push(function(e){e?t(e):t()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var d,e=d||(d={}),c=(e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed",{key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}}),l={AMap:d.notload,AMapUI:d.notload,Loca:d.notload},p={AMap:[],AMapUI:[],Loca:[]},u=[],h=function(e){"function"==typeof e&&(l.AMap===d.loaded?e(window.AMap):u.push(e))};return{load:function(n){return new Promise(function(t,s){if(l.AMap==d.failed)s("");else if(l.AMap==d.notload){var e=n.key,i=n.version,a=n.plugins;e?(window.AMap&&"lbs.amap.com"!==location.host&&s("禁止多种API加载方式混用"),c.key=e,c.AMap.version=i||c.AMap.version,c.AMap.plugins=a||c.AMap.plugins,l.AMap=d.loading,i=document.body||document.head,window.___onAPILoaded=function(e){if(delete window.___onAPILoaded,e)l.AMap=d.failed,s(e);else for(l.AMap=d.loaded,r(n).then(function(){t(window.AMap)})["catch"](s);u.length;)u.splice(0,1)[0]()},a=document.createElement("script"),a.type="text/javascript",a.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+c.AMap.version+"&key="+e+"&plugin="+c.AMap.plugins.join(","),a.onerror=function(e){l.AMap=d.failed,s(e)},i.appendChild(a)):s("请填写key")}else if(l.AMap==d.loaded)if(n.key&&n.key!==c.key)s("多个不一致的 key");else if(n.version&&n.version!==c.AMap.version)s("不允许多个版本 JSAPI 混用");else{if(e=[],n.plugins)for(i=0;i<n.plugins.length;i+=1)-1==c.AMap.plugins.indexOf(n.plugins[i])&&e.push(n.plugins[i]);e.length?window.AMap.plugin(e,function(){r(n).then(function(){t(window.AMap)})["catch"](s)}):r(n).then(function(){t(window.AMap)})["catch"](s)}else if(n.key&&n.key!==c.key)s("多个不一致的 key");else if(n.version&&n.version!==c.AMap.version)s("不允许多个版本 JSAPI 混用");else{var o=[];if(n.plugins)for(i=0;i<n.plugins.length;i+=1)-1==c.AMap.plugins.indexOf(n.plugins[i])&&o.push(n.plugins[i]);h(function(){o.length?window.AMap.plugin(o,function(){r(n).then(function(){t(window.AMap)})["catch"](s)}):r(n).then(function(){t(window.AMap)})["catch"](s)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,c={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},l={AMap:d.notload,AMapUI:d.notload,Loca:d.notload},p={AMap:[],AMapUI:[],Loca:[]}}}}()},8935:function(e,t,s){},a8cc:function(e,t,s){},aff4:function(c,e,s){"use strict";s.r(e);var i=s("2166"),t=s("7dfd"),a={name:"invoiceModal",data(){return{invoice:1,invoiceAvailable:!1,loading:!1,invoiceForm:{receiptTitle:"",taxpayerId:"",receiptContent:"商品明细"},type:1,ruleInline:{taxpayerId:[{required:!0,message:"请填写纳税人识别号"},{pattern:t.TINumber,message:"请填写正确的纳税人识别号"}]}}},props:["invoiceData"],watch:{invoiceData:{handler(e){this.invoiceForm={...e},e.taxpayerId?this.type=2:this.type=1},deep:!0,immeadite:!0}},methods:{changeInvoice(e){this.$nextTick(()=>{this.type=e})},save(){let t=!0;var e=JSON.parse(JSON.stringify(this.invoiceForm))["receiptTitle"];return e?(2===this.type?this.$refs.form.validate(e=>{e||(t=!1)}):delete this.invoiceForm.taxpayerId,t):(this.$Message.error("请填写发票抬头!"),t=!1)},async submit(){var e;this.save()&&(this.loading=!0,e={way:this.$route.query.way,...this.invoiceForm},(await Object(i.i)(e)).success&&this.$emit("change",!0),this.loading=!1)}}},o=(s("2433"),s("2877")),a=Object(o.a)(a,function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",{staticClass:"invoice-modal"},[e("Modal",{attrs:{width:"600","footer-hide":""},model:{value:t.invoiceAvailable,callback:function(e){t.invoiceAvailable=e},expression:"invoiceAvailable"}},[e("p",{attrs:{slot:"header"},slot:"header"},[e("span",[t._v("发票信息")])]),e("div",{staticClass:"nav-content"},[e("Form",{ref:"form",attrs:{model:t.invoiceForm,"label-position":"left",rules:t.ruleInline,"label-width":110}},[e("FormItem",{attrs:{label:"发票类型"}},[e("RadioGroup",{attrs:{type:"button","button-style":"solid"},model:{value:t.invoice,callback:function(e){t.invoice=e},expression:"invoice"}},[e("Radio",{attrs:{label:1},on:{"on-change":t.changeInvoice}},[t._v("电子普通发票")]),e("Radio",{attrs:{label:2,disabled:!0}},[t._v("增值税专用发票")])],1)],1),e("FormItem",{attrs:{label:"发票抬头"}},[e("RadioGroup",{attrs:{type:"button","button-style":"solid"},on:{"on-change":t.changeInvoice},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},[e("Radio",{attrs:{label:1}},[t._v("个人")]),e("Radio",{attrs:{label:2}},[t._v("单位")])],1)],1),1===t.type?e("FormItem",{attrs:{label:"个人名称",prop:"receiptTitle"}},[e("i-input",{model:{value:t.invoiceForm.receiptTitle,callback:function(e){t.$set(t.invoiceForm,"receiptTitle",e)},expression:"invoiceForm.receiptTitle"}})],1):t._e(),2===t.type?e("FormItem",{attrs:{label:"单位名称",prop:"receiptTitle"}},[e("i-input",{model:{value:t.invoiceForm.receiptTitle,callback:function(e){t.$set(t.invoiceForm,"receiptTitle",e)},expression:"invoiceForm.receiptTitle"}})],1):t._e(),2===t.type?e("FormItem",{attrs:{label:"纳税人识别号",prop:"taxpayerId"}},[e("i-input",{model:{value:t.invoiceForm.taxpayerId,callback:function(e){t.$set(t.invoiceForm,"taxpayerId",e)},expression:"invoiceForm.taxpayerId"}})],1):t._e(),e("FormItem",{attrs:{label:"发票内容"}},[e("RadioGroup",{attrs:{type:"button","button-style":"solid"},model:{value:t.invoiceForm.receiptContent,callback:function(e){t.$set(t.invoiceForm,"receiptContent",e)},expression:"invoiceForm.receiptContent"}},[e("Radio",{attrs:{label:"商品明细"}},[t._v("商品明细")]),e("Radio",{attrs:{label:"商品类别"}},[t._v("商品类别")])],1)],1)],1),e("div",{staticStyle:{"text-align":"center"}},[e("Button",{attrs:{type:"primary",loading:t.loading},on:{click:t.submit}},[t._v("保存发票信息")]),e("Button",{attrs:{type:"default"},on:{click:function(e){t.invoiceAvailable=!1}}},[t._v("取消")])],1)],1)])],1)},[],!1,null,"dced94bc",null).exports,n=s("5945"),r=s("2f94"),n={name:"addressManage",props:{id:{defalut:"",type:String}},data(){return{showAddr:!1,formData:{isDefault:!1},ruleInline:{name:[{required:!0,message:"请输入收件人姓名",trigger:"blur"}],address:[{required:!0,message:"请输入地址",trigger:"change"}],detail:[{required:!0,message:"请输入详细地址",trigger:"blur"}],mobile:[{required:!0,message:"手机号不能为空",trigger:"blur"},{type:"string",pattern:/^1[3|4|5|6|7|8][0-9]{9}$/,message:"手机号格式出错",trigger:"blur"}]},loading:!1,mapMsg:{}}},methods:{save(){this.$refs.form.validate(e=>{if(e){const e=JSON.parse(JSON.stringify(this.formData));e.consigneeAddressPath=e.address.replace(/\s/g,","),delete e.address,this.loading=!0,(this.id?Object(r.b)(e).then(e=>{this.loading=!1,e.success&&(this.$Message.success("编辑地址成功"),this.$emit("change",!0),this.hide())}):Object(r.f)(e).then(e=>{this.loading=!1,e.success&&(this.$Message.success("新增地址成功"),this.$emit("change",!0),this.hide())})).catch(()=>{this.loading=!1})}})},getAddrById(e){Object(r.c)(e).then(e=>{if(e.success){const t=e.result;t.address=e.result.consigneeAddressPath.replace(/,/g," "),this.formData=t}})},getAddress(e){this.mapMsg=e,this.$set(this.formData,"address",e.addr),this.$set(this.formData,"consigneeAddressIdPath",e.addrId),this.$set(this.formData,"detail",e.detail),this.formData.lat=e.position.lat,this.formData.lon=e.position.lng},show(){this.showAddr=!0},hide(){this.showAddr=!1}},watch:{id:{handler:function(e){e?this.getAddrById(e):(this.formData={isDefault:!1},this.$refs.form.resetFields())}}},components:{liliMap:n.a}};s("bf8e");var n=Object(o.a)(n,function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",[e("Modal",{attrs:{width:"800",title:"收件人地址"},model:{value:t.showAddr,callback:function(e){t.showAddr=e},expression:"showAddr"}},[e("Form",{ref:"form",attrs:{model:t.formData,"label-position":"left","label-width":100,rules:t.ruleInline}},[e("FormItem",{attrs:{label:"收件人",prop:"name"}},[e("i-input",{staticStyle:{width:"600px"},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),e("FormItem",{attrs:{label:"收件地区",prop:"address"}},[e("i-input",{staticStyle:{width:"600px"},attrs:{disabled:""},model:{value:t.formData.address,callback:function(e){t.$set(t.formData,"address",e)},expression:"formData.address"}}),e("Button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.$refs.map.showMap=!0}}},[t._v("选择")])],1),e("FormItem",{attrs:{label:"详细地址",prop:"detail"}},[e("i-input",{staticStyle:{width:"600px"},model:{value:t.formData.detail,callback:function(e){t.$set(t.formData,"detail",e)},expression:"formData.detail"}})],1),e("FormItem",{attrs:{label:"手机号码",prop:"mobile"}},[e("i-input",{staticStyle:{width:"600px"},model:{value:t.formData.mobile,callback:function(e){t.$set(t.formData,"mobile",e)},expression:"formData.mobile"}})],1),e("FormItem",{attrs:{label:"地址别名"}},[e("i-input",{staticStyle:{width:"600px"},attrs:{length:"",maxlength:4,placeholder:"请输入地址别名，例如公司"},model:{value:t.formData.alias,callback:function(e){t.$set(t.formData,"alias",e)},expression:"formData.alias"}})],1),e("FormItem",{attrs:{label:"默认地址"}},[e("i-switch",{model:{value:t.formData.isDefault,callback:function(e){t.$set(t.formData,"isDefault",e)},expression:"formData.isDefault"}})],1)],1),e("div",{staticClass:"mt_20",attrs:{slot:"footer"},slot:"footer"},[e("Button",{on:{click:t.hide}},[t._v("取消")]),e("Button",{staticClass:"mr_10",attrs:{type:"primary",loading:t.loading},on:{click:t.save}},[t._v("保存收货地址")])],1)],1),e("lili-map",{ref:"map",on:{getAddress:t.getAddress}})],1)},[],!1,null,"5d4b6f2e",null).exports,d=s("8194"),a={name:"Pay",components:{invoiceModal:a,addressManage:n},data(){return{stepIndex:1,invoiceAvailable:!1,showEditBtn:"",orderMark:"",invoiceData:{receiptTitle:"个人",receiptContent:"不开发票"},addressList:[],selectedAddress:{},goodsList:[],priceDetailDTO:{},totalNum:0,addrId:"",moreAddr:!1,canUseCouponNum:0,couponList:[],usedCouponId:[],selectedCoupon:{}}},mounted(){this.init()},methods:{init(){this.getGoodsDetail()},goAddressManage(){this.$router.push("/home/MyAddress")},getAddress(){Object(r.e)().then(e=>{e.success&&(this.addressList=e.result.records,this.addressList.forEach((e,t)=>{e.id===this.selectedAddress.id&&2<t&&(this.moreAddr=!0)}))})},getGoodsDetail(){this.$Spin.show(),Object(i.d)({way:this.$route.query.way}).then(t=>{if(this.$Spin.hide(),t.success){this.goodsList=t.result.cartList,this.priceDetailDTO=t.result.priceDetailDTO,this.skuList=t.result.skuList,t.result.receiptVO&&(this.invoiceData=t.result.receiptVO);let e=t.result.notSupportFreight;if(this.selectedCoupon={},t.result.platformCoupon&&(this.selectedCoupon.platformCoupon=t.result.platformCoupon),Object.assign(this.selectedCoupon,t.result.storeCoupons),e){let t=[],s;e.forEach(e=>{s=e.errorMessage,t.push(e.goodsSku.goodsName)}),this.$Modal.warning({title:"以下商品超出配送区域",content:t.toString()})}t.result.memberAddress&&(this.selectedAddress=t.result.memberAddress),this.getAddress();for(let e=this.totalNum=0;e<this.skuList.length;e++)this.totalNum+=this.skuList[e].num;this.usedCouponId=[],this.couponList=t.result.canUseCoupons;const s=Object.keys(this.selectedCoupon);s.length&&(this.couponList.forEach(e=>{e.id===this.selectedCoupon[s].memberCoupon.id&&this.usedCouponId.push(e.id)}),this.$nextTick(()=>{this.$forceUpdate()}))}}).catch(()=>{this.$Spin.hide()})},getCouponNum(){Object(i.f)({way:this.$route.query.way}).then(e=>{if(this.canUseCouponNum=e.result,e.result){let t=[],s=[];this.goodsList.forEach(e=>{t.push(e.storeId),e.skuList.forEach(e=>{s.push(e.goodsSku.id)})});e={pageNumber:1,pageSize:100,memberCouponStatus:"NEW",scopeId:s.toString(),storeId:t.toString(),totalPrice:this.priceDetailDTO.goodsPrice};Object(d.i)(e).then(e=>{e.success&&(this.couponList=e.result.records);const t=Object.keys(this.selectedCoupon);this.usedCouponId=[],t.length&&(this.couponList.forEach(e=>{e.id===this.selectedCoupon[t].memberCoupon.id&&this.usedCouponId.push(e.id)}),this.$nextTick(()=>{this.$forceUpdate()}))})}})},selectAddress(t){var e={way:this.$route.query.way,shippingAddressId:t.id};Object(i.j)(e).then(e=>{e.success&&(this.$Message.success("选择收货地址成功"),this.selectedAddress=t,this.getGoodsDetail())})},editAddress(e){this.addrId=e,this.$refs.address.show()},addrChange(){this.getAddress()},delAddress(e){this.$Modal.confirm({title:"提示",content:"你确定删除这个收货地址",onOk:()=>{Object(r.a)(e.id).then(e=>{e.success&&(this.$Message.success("删除成功"),this.getAddress())})},onCancel:()=>{}})},goGoodsDetail(e,t){e=this.$router.resolve({path:"/goodsDetail",query:{skuId:e,goodsId:t}});window.open(e.href,"_blank")},goShopPage(e){e=this.$router.resolve({path:"/Merchant",query:{id:e}});window.open(e.href,"_blank")},useCoupon(e,t){e={way:this.$route.query.way,memberCouponId:e,used:t};Object(i.k)(e).then(e=>{e.success&&this.init()})},editInvoice(){this.$refs.invModal.invoiceAvailable=!0},getInvMsg(e){e&&(this.init(),this.$refs.invModal.invoiceAvailable=!1)},pay(){const t={client:"PC",remark:[],way:this.$route.query.way};this.goodsList.forEach(e=>{e.remark&&t.remark.push({remark:e.remark,storeId:e.storeId})}),t.remark.length||delete t.remark,this.$Spin.show(),Object(i.g)(t).then(e=>{this.$Spin.hide(),e.success&&("POINTS"===t.way?this.$router.push("/payDone"):this.$router.push({path:"/payment",query:{orderType:"TRADE",sn:e.result.sn}}))}).catch(()=>{this.$Spin.hide()})},useScope(e){let t="全部商品";switch(e){case"ALL":t="全部商品";break;case"PORTION_GOODS":t="部分商品";break;case"PORTION_GOODS_CATEGORY":t="部分分类商品"}return t+"可用"}}},n=(s("20b4"),Object(o.a)(a,function(){var i=this,e=i.$createElement,a=i._self._c||e;return a("div",{staticClass:"pay-order"},[a("BaseHeader"),a("div",{staticClass:"width_1200 logo"},[a("div",[a("router-link",{attrs:{to:"/"}},[a("img",{attrs:{src:i.$store.state.logoImg}})]),a("div",[i._v("结算页")])],1),a("div",{staticClass:"cart-steps"},[a("span",{class:1==i.stepIndex?"active":""},[i._v("1.我的购物车")]),a("Icon",{class:1==i.stepIndex?"active-arrow":"",attrs:{custom:"icomoon icon-next"}}),a("span",{class:1==i.stepIndex?"active":""},[i._v("2.填写订单信息")]),a("Icon",{class:1==i.stepIndex?"active-arrow":"",attrs:{custom:"icomoon icon-next"}}),a("span",{class:2==i.stepIndex?"active":""},[i._v("3.成功提交订单")])],1)]),a("Divider"),a("div",{staticClass:"content width_1200"},[a("div",{staticClass:"address"},[a("div",{staticClass:"card-head"},[a("span",[i._v("收货人信息")]),a("span",{on:{click:i.goAddressManage}},[i._v("管理收货人地址")])]),a("div",{staticClass:"address-manage"},[i._l(i.addressList,function(t,s){return a("div",{directives:[{name:"show",rawName:"v-show",value:!!i.moreAddr||s<3,expression:"moreAddr ? true : index < 3"}],key:s,staticClass:"address-item",class:i.selectedAddress.id===t.id?"border-red":"",on:{mouseenter:function(e){i.showEditBtn=s},mouseleave:function(e){i.showEditBtn=""},click:function(e){return i.selectAddress(t)}}},[a("div",[a("span",[i._v(i._s(t.name))]),t.isDefault?a("Tag",{staticClass:"ml_10",attrs:{color:"red"}},[i._v("默认")]):i._e(),t.alias?a("Tag",{staticClass:"ml_10",attrs:{color:"warning"}},[i._v(i._s(t.alias)+" ")]):i._e()],1),a("div",[i._v(i._s(t.mobile))]),a("div",[i._v(i._s(i._f("unitAddress")(t.consigneeAddressPath))+" "+i._s(t.detail))]),a("div",{directives:[{name:"show",rawName:"v-show",value:i.showEditBtn===s,expression:"showEditBtn === index"}],staticClass:"edit-btn"},[a("span",{on:{click:function(e){return e.stopPropagation(),i.editAddress(t.id)}}},[i._v("修改")]),t.isDefault?i._e():a("span",{staticClass:"ml_10",on:{click:function(e){return e.stopPropagation(),i.delAddress(t)}}},[i._v("删除")])]),a("div",{directives:[{name:"show",rawName:"v-show",value:i.selectedAddress.id===t.id,expression:"selectedAddress.id === item.id"}],staticClass:"corner-icon"},[a("div"),a("Icon",{attrs:{type:"md-checkmark"}})],1)])}),a("div",{staticClass:"add-address",on:{click:function(e){return i.editAddress("")}}},[a("Icon",{attrs:{type:"ios-add-circle-outline"}}),a("div",[i._v("添加新地址")])],1)],2),3<i.addressList.length?a("div",{staticClass:"more-addr",on:{click:function(e){i.moreAddr=!i.moreAddr}}},[i._v(" "+i._s(i.moreAddr?"收起地址":"更多地址")+" "),a("Icon",{directives:[{name:"show",rawName:"v-show",value:!i.moreAddr,expression:"!moreAddr"}],attrs:{type:"md-arrow-dropdown"}}),a("Icon",{directives:[{name:"show",rawName:"v-show",value:i.moreAddr,expression:"moreAddr"}],attrs:{type:"md-arrow-dropup"}})],1):i._e()]),a("div",{staticClass:"goods-content"},[a("div",{staticClass:"card-head mt_20 mb_20"},[a("span",[i._v("商品信息")]),a("span",{on:{click:function(e){return i.$router.push("/cart")}}},[i._v("返回购物车")])]),i._l(i.goodsList,function(t,e){return a("div",{key:e,staticClass:"goods-msg"},[a("div",{staticClass:"shop-name"},[a("span",[a("span",{staticClass:"hover-color",on:{click:function(e){return i.goShopPage(t.storeId)}}},[i._v(i._s(t.storeName))]),i._v("   ")])]),a("div",{staticClass:"goods-list"},i._l(t.skuList,function(t,e){return a("div",{key:e,staticClass:"goods-item"},[a("span",{staticClass:"hover-color",on:{click:function(e){return i.goGoodsDetail(t.goodsSku.id,t.goodsSku.goodsId)}}},[a("img",{attrs:{src:t.goodsSku.thumbnail,alt:""}}),a("span",{staticStyle:{"vertical-align":"top"}},[i._v(i._s(t.goodsSku.goodsName))])]),a("span",{staticClass:"goods-price"},[i._v(i._s(i._f("unitPrice")(t.purchasePrice,"￥")))]),a("span",[i._v("x"+i._s(t.num))]),a("span",[i._v(i._s(0<t.goodsSku.quantity?"有货":"无货"))]),a("span",{staticClass:"goods-price"},[i._v(i._s(i._f("unitPrice")(t.subTotal,"￥")))])])}),0),a("div",{staticClass:"order-mark"},[a("Input",{attrs:{type:"textarea",maxlength:"60","show-word-limit":"",placeholder:"订单备注"},model:{value:t.remark,callback:function(e){i.$set(t,"remark",e)},expression:"shop.remark"}}),a("span",{staticStyle:{"font-size":"12px",color:"#999"}},[i._v("提示：请勿填写有关支付、收货、发票方面的信息")])],1)])})],2),a("div",{staticClass:"invoice"},[a("div",{staticClass:"card-head mt_20 mb_20"},[a("span",{staticClass:"relative"},[i._v("发票信息"),a("span",{staticClass:"inv-tips"},[a("Icon",{attrs:{type:"ios-alert-outline"}}),i._v("开企业抬头发票须填写纳税人识别号，以免影响报销 ")],1)])]),a("div",{staticClass:"inovice-content"},[a("span",[i._v(i._s(i.invoiceData.receiptTitle))]),a("span",[i._v(i._s(i.invoiceData.receiptContent))]),a("span",{on:{click:i.editInvoice}},[i._v("编辑")])])]),a("div",{staticClass:"invoice"},[i._m(0),0===i.couponList.length?a("div",[i._v("无可用优惠券")]):a("ul",{staticClass:"coupon-list"},i._l(i.couponList,function(t,e){return a("li",{key:e,staticClass:"coupon-item"},[a("div",{staticClass:"c-left"},[a("div",["PRICE"===t.couponType?a("span",{staticClass:"fontsize_12 global_color"},[i._v("￥"),a("span",{staticClass:"price"},[i._v(i._s(i._f("unitPrice")(t.price)))])]):i._e(),"DISCOUNT"===t.couponType?a("span",{staticClass:"fontsize_12 global_color"},[a("span",{staticClass:"price"},[i._v(i._s(t.discount))]),i._v("折")]):i._e(),a("span",{staticClass:"describe"},[i._v("满"+i._s(t.consumeThreshold)+"元可用")])]),a("p",[i._v("使用范围："+i._s(i.useScope(t.scopeType)))]),a("p",[i._v("有效期："+i._s(t.endTime))])]),i.usedCouponId.includes(t.id)?a("img",{staticClass:"used",attrs:{src:s("e092"),alt:""}}):i._e(),a("b"),a("a",{staticClass:"c-right",on:{click:function(e){return i.useCoupon(t.id,!0)}}},[i._v("立即使用")]),i.usedCouponId.includes(t.id)?a("a",{staticClass:"c-right",on:{click:function(e){return i.useCoupon(t.id,!1)}}},[i._v("放弃优惠")]):i._e(),a("i",{staticClass:"circle-top"}),a("i",{staticClass:"circle-bottom"})])}),0)]),a("div",{staticClass:"order-price"},[a("div",[a("span",[i._v(i._s(i.totalNum)+"件商品，总商品金额：")]),a("span",[i._v(i._s(i._f("unitPrice")(i.priceDetailDTO.goodsPrice,"￥")))])]),0<i.priceDetailDTO.freightPrice?a("div",[a("span",[i._v("运费：")]),a("span",[i._v(i._s(i._f("unitPrice")(i.priceDetailDTO.freightPrice,"￥")))])]):i._e(),0<i.priceDetailDTO.discountPrice?a("div",[a("span",[i._v("优惠金额：")]),a("span",[i._v("-"+i._s(i._f("unitPrice")(i.priceDetailDTO.discountPrice,"￥")))])]):i._e(),0<i.priceDetailDTO.couponPrice?a("div",[a("span",[i._v("优惠券金额：")]),a("span",[i._v("-"+i._s(i._f("unitPrice")(i.priceDetailDTO.couponPrice,"￥")))])]):i._e(),"POINTS"===i.$route.query.way?a("div",[a("span",[i._v("应付积分：")]),a("span",{staticClass:"actrual-price"},[i._v(i._s(i.priceDetailDTO.payPoint))])]):a("div",[a("span",[i._v("应付金额：")]),a("span",{staticClass:"actrual-price"},[i._v(i._s(i._f("unitPrice")(i.priceDetailDTO.flowPrice,"￥")))])])])]),a("div",{staticClass:"order-footer width_1200"},[a("div",{staticClass:"pay ml_20",on:{click:i.pay}},[i._v("提交订单")]),i.addressList.length?a("div",{staticClass:"pay-address"},[i._v(" 配送至："+i._s(i._f("unitAddress")(i.selectedAddress.consigneeAddressPath))+" "+i._s(i.selectedAddress.detail)+"  收货人："+i._s(i.selectedAddress.name)+"  "+i._s(i.selectedAddress.mobile)+" ")]):i._e()]),a("BaseFooter"),a("invoice-modal",{ref:"invModal",attrs:{invoiceData:i.invoiceData},on:{change:i.getInvMsg}}),a("address-manage",{ref:"address",attrs:{id:i.addrId},on:{change:i.addrChange}})],1)},[function(){var e=this.$createElement,e=this._self._c||e;return e("div",{staticClass:"card-head mt_20 mb_20"},[e("span",{staticClass:"relative"},[this._v("优惠券")])])}],!1,null,"50a18c22",null));e.default=n.exports},b88b:function(e,t,s){},bf8e:function(e,t,s){"use strict";s("8935")},e092:function(e,t,s){e.exports=s.p+"static/img/geted.3f84cfb6.png"}}]);